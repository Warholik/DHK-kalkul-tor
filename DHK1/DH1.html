<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    body {
      background-color: bisque;
      margin: 0;
      display: grid;
      align-items: center;
      justify-items: center;
    }
    .calculatorContainer {
      display: grid;
      grid-auto-flow: column;
      grid-gap: 40px;
    }
    .label {
      display: grid;
      grid-auto-flow: column;
    }
    .slider {
      display: grid;
      justify-items: center;
    }
  </style>
  <body>
    <div class="calculatorContainer">
      <h1>DH1</h1>
      <div class="slider">
        <div class="label">
          <p>Diákhitel összege &nbsp;</p>
          <p id="loanAmountLabel"></p>
        </div>
        <input id="loanAmountSlider" type="range" min="100000" max="10000000" step="100000" value="500000" />
      </div>
      <div class="slider">
        <div class="label">
          <p>Várható havi bruttó jövedelem &nbsp;</p>
          <p><span id="wageLabel"></span></p>
        </div>
        <input id="wageSlider" type="range" min="100000" max="1000000" step="10000" value="140000" />
      </div>
      <div>
        <p>Törlesztőrészlet az első évben <span id="installment1Label"></span></p>
        <p>Törlesztőrészlet a második évtől <span id="installment2Label"></span></p>
        <p>Futamidő: <span id="monthsLabel"></span></p>
      </div>
    </div>
  </body>
  <script>
    /* Init loan amount */
    var loanAmountLabel = document.getElementById("loanAmountLabel");
    var loanAmountSlider = document.getElementById("loanAmountSlider");
    loanAmountLabel.innerText = changeAmountInHUF(loanAmountSlider.value);
    var loanAmount = loanAmountSlider.value;

    /* Function for changing loan amount*/
    loanAmountSlider.oninput = function () {
      loanAmountLabel.innerHTML = changeAmountInHUF(this.value);
      loanAmount = this.value;
      calculateLoan();
    };

    /* Init wage */
    var wageLabel = document.getElementById("wageLabel");
    var wageSlider = document.getElementById("wageSlider");
    wageLabel.innerText = changeAmountInHUF(wageSlider.value);
    var wage = wageSlider.value;
    /* Function for changing loan amount*/
    wageSlider.oninput = function () {
      wageLabel.innerHTML = changeAmountInHUF(this.value);
      wage = this.value;
      calculateLoan();
    };

    /*Init month variables */
    var months = 1;
    var monthsLabel = document.getElementById("monthsLabel");
    monthsLabel.innerText = months;

    /*declare interest and minimum variables */
    var interest = 0.0199;
    var minimumWage = 120000;

    /* Init installment for the first year */
    var installment1 = minimumWage * 0.06;
    var installment1Label = document.getElementById("installment1Label");
    installment1Label.innerText = installment1;

    /* Init installment for the second year */
    var installment2 = wage * 0.06 < installment1 ? installment1 : wage * 0.06;
    var installment2Label = document.getElementById("installment2Label");
    installment2Label.innerText = installment2;

    var montlyInstallment = months <= 14 ? installment1 : installment2;
    var paidInstallment = ((interest / 12) * loanAmount * 365) / 360;
    var debt = Math.ceil(loanAmount - montlyInstallment + paidInstallment);
    var installment = montlyInstallment - paidInstallment < 0 ? 0 : montlyInstallment - paidInstallment;

    function calculateLoan() {
      /*Init the variables */
      months = 1;
      installment2 = wage * 0.06 < installment1 ? installment1 : wage * 0.06;
      montlyInstallment = months <= 14 ? installment1 : installment2;
      paidInstallment = ((interest / 12) * loanAmount * 365) / 360;
      debt = Math.ceil(loanAmount - montlyInstallment + paidInstallment);
      installment = montlyInstallment - paidInstallment < 0 ? 0 : montlyInstallment - paidInstallment;

      while (debt >= 0) {
        months = months + 1;
        montlyInstallment = months <= 14 ? installment1 : installment2;
        paidInstallment = ((interest / 12) * debt * 365) / 360;
        debt = Math.ceil(debt - montlyInstallment + paidInstallment);
        installment = montlyInstallment - paidInstallment < 0 ? 0 : montlyInstallment - paidInstallment;
        //console.log(months + " " + paidInstallment + " " + debt +" " + installment)
        /* if something gone wrong... */
        if (months > 1200) {
          debt = -10;
        }
      }
      if (debt != -10) {
        monthsLabel.innerText = monthInYYMM(months);
        installment1Label.innerText = installment1;
        installment2Label.innerText = installment2;
      } else {
        monthsLabel.innerHTML = "A futamidő túl hosszú, <br> módosítsa a megadott adatokat!.";
        installment1Label.innerText = installment1;
        installment2Label.innerText = installment2;
      }
    }

    function monthInYYMM(months) {
      var dateYears = Math.floor(months / 12);
      var dateMonths = months % 12;
      var formattedMonths = dateYears + " év " + dateMonths + " hónap";
      return formattedMonths;
    }

    /*
     * Set the proper visaual for the money amount
     * It round up for the nearest integer
     */
    function changeAmountInHUF(amout) {
      return Intl.NumberFormat("hu-HU", {
        style: "currency",
        currency: "HUF",
        minimumFractionDigits: 0,
      }).format(Math.ceil(amout));
    }

    calculateLoan();
  </script>
</html>
