<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    body {
      background-color: bisque;
      margin: 0;
      display: grid;
      align-items: center;
      justify-items: center;
    }
    .calculatorContainer {
      display: grid;
      grid-auto-flow: column;
      grid-gap: 40px;
    }
    .label {
      display: grid;
      grid-auto-flow: column;
    }
    .slider {
      display: grid;
      justify-items: center;
    }
  </style>
  <body>
    <div class="calculatorContainer">
      <h1>DH1 - változtatható futamidő</h1>
      <div class="slider">
        <div class="label">
          <p>Diákhitel összege &nbsp;</p>
          <p id="loanAmountLabel"></p>
        </div>
        <input id="loanAmountSlider" type="range" min="100000" max="10000000" step="100000" value="500000" />
      </div>
      <div class="slider">
        <div class="label">
          <p>Futamidő &nbsp;</p>
          <p><span id="monthsLabel"></span></p>
        </div>
        <input id="monthsSlider" type="range" min="12" max="300" step="12" value="24" />
      </div>
      <div>
        <p>Törlesztőrészlet <span id="installmentLabel"></span></p>
      </div>
    </div>
  </body>
  <script>
    /* Init loan amount */
    var loanAmountLabel = document.getElementById("loanAmountLabel");
    var loanAmountSlider = document.getElementById("loanAmountSlider");
    loanAmountLabel.innerText = changeAmountInHUF(loanAmountSlider.value);
    var loanAmount = loanAmountSlider.value;

    /* Function for changing loan amount*/
    loanAmountSlider.oninput = function () {
      loanAmountLabel.innerHTML = changeAmountInHUF(this.value);
      loanAmount = this.value;
      calculateLoan();
    };

    /* Init months */
    var monthsLabel = document.getElementById("monthsLabel");
    var monthsSlider = document.getElementById("monthsSlider");
    monthsLabel.innerText = Math.floor(monthsSlider.value / 12) + " Év " + (monthsSlider.value % 12) + " Hónap";
    var months = monthsSlider.value;
    /* Function for changing loan amount*/
    monthsSlider.oninput = function () {
      months = this.value;
      monthsLabel.innerHTML = monthInYYMM(months);
      calculateLoan();
    };

    var interest = 0.0199;
    var P = (interest * 365) / 360 / 12;
    var q = 1 + P;
    var qn = Math.pow(q, months);
    var qnminus1 = qn - 1;

    var installmentLabel = document.getElementById("installmentLabel");
    var installment = months < 1 ? 0 : Math.ceil((loanAmount * P * qn) / qnminus1);

    function calculateLoan() {
      qn = Math.pow(q, months);
      qnminus1 = qn - 1;
      installment = months < 1 ? 0 : Math.ceil((loanAmount * P * qn) / qnminus1);
      installmentLabel.innerText = changeAmountInHUF(installment);
    }

    function monthInYYMM(months) {
      var dateYears = Math.floor(months / 12);
      var dateMonths = months % 12;

      var formattedMonths = dateYears + " év " + dateMonths + " hónap";
      return formattedMonths;
    }

    /*
     * Set the proper visaual for the money amount
     * It round up for the nearest integer
     */
    function changeAmountInHUF(amout) {
      return Intl.NumberFormat("hu-HU", {
        style: "currency",
        currency: "HUF",
        minimumFractionDigits: 0,
      }).format(Math.ceil(amout));
    }

    calculateLoan();
  </script>
</html>
