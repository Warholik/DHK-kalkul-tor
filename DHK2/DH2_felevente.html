<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    body {
      background-color: bisque;
      margin: 0;
      display: grid;
      align-items: center;
      justify-items: center;
    }
    .calculatorContainer {
      display: grid;
      grid-auto-flow: column;
      grid-gap: 40px;
    }
    .label {
      display: grid;
      grid-auto-flow: column;
    }
    .slider {
      display: grid;
      justify-items: center;
    }
  </style>
  <body>
    <div class="calculatorContainer">
      <h1>DH2</h1>
      <div class="slider">
        <div class="label">
          <p>Diákhitel összege &nbsp;</p>
          <p id="semesterLoanAmountLabel"></p>
        </div>
        <input id="semesterLoanAmountSlider" type="range" min="30000" max="150000" step="10000" value="50000" />
      </div>
      <div class="slider">
        <div class="label">
          <p>Várható havi bruttó jövedelem &nbsp;</p>
          <p><span id="wageLabel"></span></p>
        </div>
        <input id="wageSlider" type="range" min="100000" max="1000000" step="10000" value="140000" />
      </div>
      <div class="slider">
        <div class="label">
          <p>Félévek száma: &nbsp;</p>
          <p><span id="semesterLabel"></span></p>
        </div>
        <input id="semesterSlider" type="range" min="1" max="14" step="1" value="4" />
      </div>
      <div>
        <p>Összesen felvett hitel összege: <span id="LoanAmountLabel"></span></p>
        <p>Törlesztőrészlet az első évben <span id="installment1Label"></span></p>
        <p>Törlesztőrészlet a második évtől <span id="installment2Label"></span></p>
        <p>Futamidő <span id="monthsLabel"></span> hónap</p>
      </div>
    </div>
  </body>
  <script>
    /* Init loan amount */
    var semesterLoanAmountLabel = document.getElementById("semesterLoanAmountLabel");
    var semesterLoanAmountSlider = document.getElementById("semesterLoanAmountSlider");
    semesterLoanAmountLabel.innerText = changeAmountInHUF(semesterLoanAmountSlider.value);
    var semesterLoanAmount  = semesterLoanAmountSlider.value;

    /* Function for changing loan amount*/
    semesterLoanAmountSlider.oninput = function () {
      semesterLoanAmountLabel.innerHTML = changeAmountInHUF(this.value);
      semesterLoanAmount = this.value;
      calculateLoan();
    };

    /* Init semester */
    var semesterLabel = document.getElementById("semesterLabel");
    var semesterSlider = document.getElementById("semesterSlider");
    semesterLabel.innerText = semesterSlider.value;
    var semester = semesterSlider.value;
    /* Function for changing semester*/
    semesterSlider.oninput = function () {
      semesterLabel.innerHTML = this.value;
      semester = this.value;
      calculateLoan();
    };

    var loanAmount = semesterLoanAmount * semester;
    var loanAmountLabel = document.getElementById("LoanAmountLabel");
    loanAmountLabel.innerHTML = loanAmount;

    /* Init wage */
    var wageLabel = document.getElementById("wageLabel");
    var wageSlider = document.getElementById("wageSlider");
    wageLabel.innerText = changeAmountInHUF(wageSlider.value);
    var wage = wageSlider.value;
    /* Function for changing loan amount*/
    wageSlider.oninput = function () {
      wageLabel.innerHTML = changeAmountInHUF(this.value);
      wage = this.value;
      calculateLoan();
    };

    /*Init month variables */
    var months = 1;
    var monthsLabel = document.getElementById("monthsLabel");
    monthsLabel.innerText = months;

    /*declare interest and minimum variables */
    var interest = 0.0;
    var minimumWage = 120000;

    /* Init installment for the first year */
    var installment1 = minimumWage * 0.06;
    var installment1Label = document.getElementById("installment1Label");
    installment1Label.innerText = installment1;

    /* Init installment for the second year */
    var installment2Interest = getInstallment2Interest();
    var installment2 = wage * installment2Interest < installment1 ? installment1 : wage * installment2Interest;
    var installment2Label = document.getElementById("installment2Label");
    installment2Label.innerText = installment2;

    var montlyInstallment = months <= 14 ? installment1 : installment2;
    var paidInstallment = ((interest / 12) * loanAmount * 365) / 360;
    var debt = Math.ceil(loanAmount - montlyInstallment + paidInstallment);
    var installment = montlyInstallment - paidInstallment < 0 ? 0 : montlyInstallment - paidInstallment;

    function getInstallment2Interest() {
      var yearWage = wage * 12;
      var installment2Interest = 0;
      if (yearWage <= 1000000) {
        installment2Interest = 0.04;
      } else if (yearWage <= 2000000) {
        installment2Interest = 0.05;
      } else if (yearWage <= 3000000) {
        installment2Interest = 0.07;
      } else if (yearWage <= 4000000) {
        installment2Interest = 0.09;
      } else if (yearWage > 4000000) {
        installment2Interest = 0.11;
      }
      console.log(installment2Interest);
      return installment2Interest;
    }

    function calculateLoan() {
      /*Init the variables */
      loanAmount = semesterLoanAmount * semester;
      loanAmountLabel.innerHTML = loanAmount;
      months = 1;
      installment2Interest = getInstallment2Interest();
      installment2 = wage * installment2Interest < installment1 ? installment1 : wage * installment2Interest;
      montlyInstallment = months <= 14 ? installment1 : installment2;
      paidInstallment = ((interest / 12) * loanAmount * 365) / 360;
      debt = Math.ceil(loanAmount - montlyInstallment + paidInstallment);
      installment = montlyInstallment - paidInstallment < 0 ? 0 : montlyInstallment - paidInstallment;

      while (debt >= 0) {
        months = months + 1;
        montlyInstallment = months <= 14 ? installment1 : installment2;
        paidInstallment = ((interest / 12) * debt * 365) / 360;
        debt = Math.ceil(debt - montlyInstallment + paidInstallment);
        installment = montlyInstallment - paidInstallment < 0 ? 0 : montlyInstallment - paidInstallment;
      }
      monthsLabel.innerText = monthInYYMM(months);
      installment1Label.innerText = changeAmountInHUF(installment1);
      installment2Label.innerText = changeAmountInHUF(installment2);
    }

    function monthInYYMM(months) {
      var dateYears = Math.floor(months / 12);
      var dateMonths = months % 12;

      var formattedMonths = dateYears + " év " + dateMonths + " hónap";
      return formattedMonths;
    }

    /*
     * Set the proper visaual for the money amount
     * It round up for the nearest integer
     */
    function changeAmountInHUF(amout) {
      return Intl.NumberFormat("hu-HU", {
        style: "currency",
        currency: "HUF",
        minimumFractionDigits: 0,
      }).format(Math.ceil(amout));
    }

    calculateLoan();
  </script>
</html>
